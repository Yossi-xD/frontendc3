<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Profile</title>
  <link rel="stylesheet" href="/profile/profile.css" />
</head>
<body>
  <header class="main-header">
    <div class="logo-section">
      <span class="logo-icon">üì¶</span>
      <span class="logo-text">C¬≥</span>
    </div>
    <nav class="nav-links">
      <a href="../Dashboard Page/dashboard.html">Dashboard</a>
      <a href="../post delivery page/post-delivery.html">Post Delivery</a>
      <a href="../Browse Requests/browse-requests.html">Browse Requests</a>
      <a href="../track delivery/track-delivery.html">Track Delivery</a>
      <a href="../messages/index.html">Messages</a>
      <a href="../profile/profile.html" class="active">Profile</a>
      <a href="../payment page/payment.html">Payment</a>
      <a href="../accessibility/accessibility.html">Accessibility</a>
      <a href="../main/main.html">Logout</a>
    </nav>
  </header>

  <main class="profile-container">
    <h1>My Profile</h1>
    <p class="subheading">Manage your profile information and view your delivery history.</p>

    <div class="profile-grid">
      <section class="card profile-info">
        <div class="section-header">
          <h2>Basic Information</h2>
          <button class="edit-btn">‚úé Edit Profile</button>
        </div>
        <div class="user-details">
          <div class="avatar" id="avatar">--</div>
          <div>
            <h3 id="profile-name">User <span class="verified">‚úîÔ∏è</span></h3>
            <p class="rating">‚≠ê <span id="rating">--</span> (<span id="deliveries">--</span> deliveries)</p>
            <p class="joined">üìÖ Joined <span id="joined-date">--</span></p>
          </div>
        </div>
        <div class="info-list">
          <p><strong>Full Name:</strong> <span id="full-name"></span></p>
          <p><strong>Email Address:</strong> <span id="email"></span></p>
          <p><strong>Phone Number:</strong> <span id="phone"></span></p>
          <p><strong>Location:</strong> <span id="location"></span></p>
          <p><strong>Bio:</strong> <span id="bio"></span></p>
        </div>
      </section>

      <section class="card performance">
        <h2>Performance Stats</h2>
        <ul>
          <li><strong>Total Deliveries:</strong> <span id="deliveries"></span></li>
          <li><strong>Average Rating:</strong> <span id="rating"></span></li>
          <li><strong>Successful Requests:</strong> <span id="successful"></span></li>
          <li><strong>Response Time:</strong> <span id="response-time"></span></li>
        </ul>
      </section>

      <section class="card verification">
        <h2>Verification Status</h2>
        <ul>
          <li>Identity Verification <span class="verified-pill">Verified</span></li>
          <li>Phone Verification <span class="verified-pill">Verified</span></li>
          <li>Email Verification <span class="verified-pill">Verified</span></li>
        </ul>
      </section>

      <section class="card reviews">
        <h2>Reviews & Ratings</h2>
        <div class="review">
          <p><strong>Yousef Johnson</strong> (‚≠ê 5) <span class="role">as traveler</span></p>
          <p>Hamad was incredibly professional and delivered my laptop safely and on time. Great communication throughout!</p>
          <span class="date">1/20/2025</span>
        </div>
        <div class="review">
          <p><strong>Hamad Chen</strong> (‚≠ê 4) <span class="role">as traveler</span></p>
          <p>Good delivery service, item arrived as expected. Would recommend.</p>
          <span class="date">1/18/2025</span>
        </div>
        <div class="review">
          <p><strong>Mohamed Rodriguez</strong> (‚≠ê 5) <span class="role">as requester</span></p>
          <p>Very clear instructions and easy pickup. Great person to work with!</p>
          <span class="date">1/15/2025</span>
        </div>
      </section>

      <section class="card quick-actions">
        <h2>Quick Actions</h2>
        <ul>
          <li><a href="#">Download Delivery History</a></li>
          <li><a href="#">Privacy Settings</a></li>
          <li><a href="#">Account Settings</a></li>
          <li><a href="#" class="danger">Deactivate Account</a></li>
        </ul>
      </section>
    </div>
  </main>

<script>
window.addEventListener("DOMContentLoaded", async () => {
  const token = localStorage.getItem("token");
  const role = localStorage.getItem("userRole");

  if (!token || !role) {
    alert("Please log in first.");
    return (window.location.href = "../main/main.html");
  }

  try {
    const res = await fetch("/api/users/profile", {
      headers: {
        Authorization: "Bearer " + token,
      },
    });
    const data = await res.json();

    // ‚úÖ Fill Basic Info
    document.querySelector(".user-details h3").textContent = data.name;
    document.querySelector(".info-list").innerHTML = `
      <p><strong>Full Name:</strong> ${data.name}</p>
      <p><strong>Email Address:</strong> ${data.email}</p>
      <p><strong>Phone Number:</strong> ${data.phone || "+1 (555) 000-0000"}</p>
      <p><strong>Location:</strong> ${role === "requester" ? "Tel Aviv, TLV" : (data.location || "Italy")}</p>
      <p><strong>Bio:</strong> ${data.bio || "Reliable and friendly user."}</p>
    `;

    // ‚úÖ Add deliveries / rating if traveler
    const deliveries = role === "requester" ? "--" : data.deliveries || "--";
    const rating = role === "requester" ? "--" : data.rating || "--";
    const joinedDate = new Date(data.createdAt).toLocaleDateString();

    document.querySelector(".rating").innerHTML = `‚≠ê ${rating} (${deliveries} deliveries)`;
    document.querySelector(".joined").textContent = `üìÖ Joined ${joinedDate}`;

    // ‚úÖ Fill performance stats (manually if requester)
    const statsSection = document.querySelector(".card.performance ul");
    if (role === "requester") {
      statsSection.innerHTML = `
        <li><strong>Total Deliveries:</strong> 23</li>
        <li><strong>Average Rating:</strong> 4.8</li>
        <li><strong>Successful Requests:</strong> 15</li>
        <li><strong>Response Time:</strong> < 2hrs</li>
      `;
    } else {
      statsSection.innerHTML = `
        <li><strong>Total Deliveries:</strong> ${data.deliveries || 0}</li>
        <li><strong>Average Rating:</strong> ${data.rating || "--"}</li>
        <li><strong>Successful Requests:</strong> ${data.successful || 0}</li>
        <li><strong>Response Time:</strong> ${data.responseTime || "< 2hrs"}</li>
      `;
    }

    // ‚úÖ Reviews based on role
    const reviewsContainer = document.querySelector(".card.reviews");
    if (role === "requester") {
      reviewsContainer.innerHTML = `
        <h2>Traveler Reviews</h2>
        <div class="review">
          <p><strong>Yousef Johnson</strong> (‚≠ê 5)</p>
          <p>Delivered the laptop on time, very professional!</p>
          <span class="date">2/20/2025</span>
        </div>
        <div class="review">
          <p><strong>Ali Reza</strong> (‚≠ê 4.5)</p>
          <p>Great communication and arrived early. Will book again.</p>
          <span class="date">2/12/2025</span>
        </div>
      `;
    } else {
      reviewsContainer.innerHTML = `
        <h2>Requester Reviews</h2>
        <div class="review">
          <p><strong>Mohamed Rodriguez</strong> (‚≠ê 5)</p>
          <p>Easy pickup and very clear instructions.</p>
          <span class="date">1/15/2025</span>
        </div>
        <div class="review">
          <p><strong>Samir Patel</strong> (‚≠ê 4)</p>
          <p>Pickup location was tricky, but request was clear.</p>
          <span class="date">1/10/2025</span>
        </div>
      `;
    }
  } catch (err) {
    console.error("Error loading profile:", err);
  }
});

  const userRole = localStorage.getItem("userRole");

  if (userRole === "traveler") {
    // Hide "Post Delivery" link for travelers
    const navLinks = document.querySelectorAll(".nav-links a");
    navLinks.forEach(link => {
      if (link.textContent.trim() === "Post Delivery") {
        link.style.display = "none";
      }
    });
  }
</script>

</body>
</html>
